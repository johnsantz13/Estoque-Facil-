<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estoque Fácil - Simulador de Vendas</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Favicon (60x40 PNG recomendado) -->
    <link rel="icon" type="image/png" sizes="60x40" href="/imagens/favicon-60x40.png">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="font-[Inter,sans-serif] h-screen overflow-hidden">

    <!-- ========== BARRA LATERAL ========== -->
    <div data-include="sidebar"></div>
    
    <!-- CONTEÚDO PRINCIPAL -->
    <div id="main-content" class="relative h-screen overflow-y-auto">
        <div data-include="header"></div>

        <!-- Conteúdo Específico da Página -->
        <main class="p-6 space-y-6">
            <!-- Seção de Simulação -->
            <div class="bg-white/80 backdrop-blur-sm dark:bg-gray-800/80 p-6 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold text-gray-700 dark:text-white mb-4">Simulador de Vendas</h2>
                <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-end">
                    <!-- Seleção de Produtos -->
                    <div class="md:col-span-5">
                        <label for="product-select" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Selecione um Produto</label>
                        <select id="product-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5"></select>
                    </div>
                    <div class="md:col-span-2">
                        <label for="product-quantity" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Quantidade</label>
                        <input type="number" id="product-quantity" value="1" min="1" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5">
                    </div>
                    <div class="md:col-span-2">
                        <button id="add-product-btn" class="w-full text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                            Adicionar
                        </button>
                    </div>
                    <!-- Botões de Ação -->
                    <div class="md:col-span-3 flex gap-2">
                        <button id="simulate-btn" class="w-full text-white bg-orange-600 hover:bg-orange-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center flex items-center justify-center">
                            <i class="bi bi-play-fill text-lg mr-2"></i>Simular
                        </button>
                        <button id="reset-btn" class="w-full text-gray-700 bg-gray-200 hover:bg-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center flex items-center justify-center">
                            <i class="bi bi-arrow-counterclockwise text-lg mr-2"></i>Reset
                        </button>
                    </div>
                </div>
                
                <!-- Lista de Produtos para Simulação -->
                <div class="mt-6">
                    <h3 class="text-md font-semibold text-gray-700 dark:text-white mb-4">Produtos na Simulação</h3>
                    <div id="simulation-list" class="space-y-2">
                        <!-- Produtos adicionados aparecerão aqui -->
                    </div>
                </div>
            </div>

            <!-- Análise de Ingredientes -->
            <div class="bg-white/80 backdrop-blur-sm dark:bg-gray-800/80 p-6 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold text-gray-700 dark:text-white mb-4">Análise de Ingredientes</h2>
                <div class="relative overflow-x-auto">
                    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                            <tr>
                                <th scope="col" class="px-6 py-3">Ingrediente</th>
                                <th scope="col" class="px-6 py-3">Estoque Atual</th>
                                <th scope="col" class="px-6 py-3">Estoque Previsto</th>
                                <th scope="col" class="px-6 py-3">Diferença</th>
                                <th scope="col" class="px-6 py-3">Status</th>
                            </tr>
                        </thead>
                        <tbody id="ingredients-table-body">
                           <!-- Dados dos ingredientes serão preenchidos via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
    <script src="/js/includes.js"></script>
    <script src="/js/script.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA ---
        const ingredients = {
            'Farinha de Trigo': { currentStock: 50, unit: 'Kg' },
            'Açúcar Cristal': { currentStock: 20, unit: 'Kg' },
            'Ovos': { currentStock: 150, unit: 'Un' },
            'Leite': { currentStock: 40, unit: 'L' },
            'Chocolate em Pó': { currentStock: 15, unit: 'Kg' },
            'Batata': { currentStock: 100, unit: 'Kg' },
        };

        const products = {
            'Bolo de Chocolate': {
                recipe: { 'Farinha de Trigo': 0.5, 'Açúcar Cristal': 0.3, 'Ovos': 4, 'Leite': 0.2, 'Chocolate em Pó': 0.5 }
            },
            'Pão Caseiro': {
                recipe: { 'Farinha de Trigo': 1, 'Açúcar Cristal': 0.1, 'Ovos': 2, 'Leite': 0.5 }
            },
            'Porção de Batata Frita': {
                recipe: { 'Batata': 0.8 }
            }
        };

        let simulationList = []; // Array to store { productName, quantity }

        // --- UI ELEMENTS ---
        const productSelect = document.getElementById('product-select');
        const productQuantityInput = document.getElementById('product-quantity');
        const addProductBtn = document.getElementById('add-product-btn');
        const simulationListDiv = document.getElementById('simulation-list');
        const ingredientsTableBody = document.getElementById('ingredients-table-body');
        const simulateBtn = document.getElementById('simulate-btn');
        const resetBtn = document.getElementById('reset-btn');

        // --- FUNCTIONS ---

        // Populate ingredients table
        const renderIngredientsTable = (simulationResult = {}) => {
            ingredientsTableBody.innerHTML = '';
            for (const name in ingredients) {
                const ing = ingredients[name];
                const consumed = simulationResult[name] ? simulationResult[name].consumed : 0;
                const predictedStock = ing.currentStock - consumed;
                const difference = -consumed;

                let status = '<span class="bg-green-100 text-green-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded">OK</span>';
                if (predictedStock < 0) {
                    status = '<span class="bg-red-100 text-red-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded">Insuficiente</span>';
                }

                const row = document.createElement('tr');
                row.className = 'bg-white border-b dark:bg-gray-800 dark:border-gray-700';
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">${name}</td>
                    <td class="px-6 py-4">${ing.currentStock} ${ing.unit}</td>
                    <td class="px-6 py-4">${predictedStock.toFixed(2)} ${ing.unit}</td>
                    <td class="px-6 py-4">${difference.toFixed(2)} ${ing.unit}</td>
                    <td class="px-6 py-4">${status}</td>
                `;
                ingredientsTableBody.appendChild(row);
            }
        };

        // Populate products dropdown
        const populateProductsDropdown = () => {
            for (const name in products) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                productSelect.appendChild(option);
            }
        };

        // Render the list of products added to the simulation
        const renderSimulationList = () => {
            simulationListDiv.innerHTML = '';
            if (simulationList.length === 0) {
                simulationListDiv.innerHTML = '<p class="text-sm text-gray-500">Nenhum produto adicionado à simulação.</p>';
                return;
            }

            simulationList.forEach((item, index) => {
                const element = document.createElement('div');
                element.className = 'flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-2 rounded-lg';
                element.innerHTML = `
                    <p class="text-sm font-medium text-gray-900 dark:text-white">${item.quantity}x ${item.productName}</p>
                    <button class="text-red-500 hover:text-red-700" data-index="${index}">&times; Remover</button>
                `;
                simulationListDiv.appendChild(element);
            });
        };

        // Add product to simulation
        const handleAddProduct = () => {
            const productName = productSelect.value;
            const quantity = parseInt(productQuantityInput.value, 10);

            if (!productName || quantity <= 0) return;

            // Check if product is already in the list
            const existingProduct = simulationList.find(p => p.productName === productName);
            if (existingProduct) {
                existingProduct.quantity += quantity;
            } else {
                simulationList.push({ productName, quantity });
            }
            
            renderSimulationList();
            productQuantityInput.value = '1'; // Reset quantity
        };

        // Remove product from simulation
        const handleRemoveProduct = (e) => {
            if (e.target.tagName === 'BUTTON' && e.target.dataset.index) {
                const index = parseInt(e.target.dataset.index, 10);
                simulationList.splice(index, 1);
                renderSimulationList();
            }
        };

        // Run the simulation
        const runSimulation = () => {
            const requiredIngredients = {};

            // Calculate total required ingredients
            simulationList.forEach(item => {
                const product = products[item.productName];
                for (const ingName in product.recipe) {
                    if (!requiredIngredients[ingName]) {
                        requiredIngredients[ingName] = { consumed: 0 };
                    }
                    requiredIngredients[ingName].consumed += product.recipe[ingName] * item.quantity;
                }
            });

            renderIngredientsTable(requiredIngredients);
        };

        // Reset the simulation
        const resetSimulation = () => {
            simulationList = [];
            renderSimulationList();
            renderIngredientsTable(); // Render with empty results
        };


        // --- EVENT LISTENERS ---
        addProductBtn.addEventListener('click', handleAddProduct);
        simulationListDiv.addEventListener('click', handleRemoveProduct);
        simulateBtn.addEventListener('click', runSimulation);
        resetBtn.addEventListener('click', resetSimulation);

        // --- INITIALIZATION ---
        populateProductsDropdown();
        renderSimulationList();
        renderIngredientsTable();
    });
    </script>
</body>
</html>
